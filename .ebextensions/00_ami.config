#
# Nessie's AWS configs
#

packages:
  yum:
    gcc-c++: []
    git: []
    mod_ssl: []
    openssl-devel: []

option_settings:
  aws:elasticbeanstalk:cloudwatch:logs:
    StreamLogs: true
    DeleteOnTerminate: false
    RetentionInDays: 180
  aws:elasticbeanstalk:environment:proxy:
    ProxyServer: apache
  aws:elasticbeanstalk:environment:proxy:staticfiles:
    /static: dist/static

files:
  /etc/awslogs/config/nessie_log.conf:
    mode: '000644'
    owner: root
    group: root
    content: |
      {
        "logs": {
          "logs_collected": {
            "files": {
              "collect_list": [
                {
                  "file_path": "/var/app/current/log/nessie.log",
                  "log_group_name": "`{"Fn::Join":["/", ["/aws/elasticbeanstalk", { "Ref":"AWSEBEnvironmentName" }, "opt/python/log/nessie.log"]]}`",
                  "log_stream_name": "{instance_id}"
                }
              ]
            }
          },
          "force_flush_interval" : 15
        }
      }
